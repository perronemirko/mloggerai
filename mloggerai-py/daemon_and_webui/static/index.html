<!-- <!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ErrorSolver Daemon</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: #121212; color: #eee; }
#log { white-space: pre-wrap; background: #1e1e1e; padding: 1rem; height: 60vh; overflow-y: auto; border-radius: 0.25rem; }
</style>
</head>
<body class="p-4">
<div class="container">
    <h2 class="mb-4">‚öôÔ∏è ErrorSolver Daemon Web UI</h2>

    <form id="form" class="row g-3 mb-3">
        <div class="col-auto">
            <select class="form-select" name="mode">
                <option value="journal">Journalctl</option>
                <option value="wrap">Command</option>
            </select>
        </div>
        <div class="col-auto">
            <input class="form-control" name="command" placeholder="Comando (solo wrap)">
        </div>
        <div class="col-auto">
            <input class="form-control" name="pattern" placeholder="Filtro regex">
        </div>
        <div class="col-auto">
            <button class="btn btn-success" type="submit">Start</button>
            <button class="btn btn-danger" type="button" id="stop">Stop</button>
            <button class="btn btn-secondary" type="button" id="clear">Clear</button>
        </div>
    </form>

    <div id="log" class="border"></div>
</div>

<script>
const logDiv = document.getElementById('log');
const ws = new WebSocket(`ws://${location.host}/ws`);

ws.onmessage = ev => {
    const msg = JSON.parse(ev.data);
    logDiv.innerHTML += `\n\nüî¥ ${msg.timestamp}\n${msg.error}\nüí° ${msg.solution}\n`;
    logDiv.scrollTop = logDiv.scrollHeight;
};

document.getElementById('form').onsubmit = async e => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const response = await fetch('/start', { method: 'POST', body: formData });
    const result = await response.json();
    if(result.status === "ok"){
        logDiv.innerHTML += "\n‚úÖ Monitor avviato\n";
    } else {
        logDiv.innerHTML += `\n‚ùå ${result.message}\n`;
    }
    logDiv.scrollTop = logDiv.scrollHeight;
};

document.getElementById('stop').onclick = async () => {
    const response = await fetch('/stop', { method: 'POST' });
    const result = await response.json();
    if(result.status === "ok"){
        logDiv.innerHTML += "\nüõë Monitor fermato\n";
    } else {
        logDiv.innerHTML += `\n‚ùå ${result.message}\n`;
    }
    logDiv.scrollTop = logDiv.scrollHeight;
};

document.getElementById('clear').onclick = () => {
    logDiv.innerHTML = '';
};
</script>
</body>
</html> -->
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ErrorSolver Daemon</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
html, body { height: 100%; margin: 0; padding: 0; background: #121212; color: #eee; }
#log { white-space: pre-wrap; background: #1e1e1e; padding: 1rem; height: calc(100vh - 150px); overflow-y: auto; border-radius: 0.25rem; resize: vertical; }
.container { height: 100%; display: flex; flex-direction: column; }
.form-row { flex-wrap: wrap; }
</style>
</head>
<body>
<div class="container p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>‚öôÔ∏è ErrorSolver Daemon Web UI</h2>
        <span id="status" class="badge bg-secondary">Fermo</span>
    </div>

    <form id="form" class="row g-2 mb-3">
        <div class="col-auto">
            <select class="form-select" name="mode">
                <option value="journal">Journalctl</option>
                <option value="wrap">Command</option>
            </select>
        </div>
        <div class="col-auto">
            <input class="form-control" name="command" placeholder="Comando (solo wrap)">
        </div>
        <div class="col-auto">
            <input class="form-control" name="pattern" placeholder="Filtro regex">
        </div>
        <div class="col-auto d-flex gap-1">
            <button class="btn btn-success" type="submit">Start</button>
            <button class="btn btn-danger" type="button" id="stop">Stop</button>
            <button class="btn btn-secondary" type="button" id="clear">Clear</button>
        </div>
    </form>

    <div id="log" class="flex-grow-1 border"></div>
</div>

<script>
const logDiv = document.getElementById('log');
const statusBadge = document.getElementById('status');
const ws = new WebSocket(`ws://${location.host}/ws`);

ws.onmessage = ev => {
    const msg = JSON.parse(ev.data);
    logDiv.innerHTML += `\n\nüî¥ ${msg.timestamp}\n${msg.error}\nüí° ${msg.solution}\n`;
    logDiv.scrollTop = logDiv.scrollHeight;
};

document.getElementById('form').onsubmit = async e => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const response = await fetch('/start', { method: 'POST', body: formData });
    const result = await response.json();
    if(result.status === "ok"){
        logDiv.innerHTML += "\n‚úÖ Monitor avviato\n";
        statusBadge.textContent = "Attivo";
        statusBadge.className = "badge bg-success";
    } else {
        logDiv.innerHTML += `\n‚ùå ${result.message}\n`;
    }
    logDiv.scrollTop = logDiv.scrollHeight;
};

document.getElementById('stop').onclick = async () => {
    const response = await fetch('/stop', { method: 'POST' });
    const result = await response.json();
    if(result.status === "ok"){
        logDiv.innerHTML += "\nüõë Monitor fermato\n";
        statusBadge.textContent = "Fermo";
        statusBadge.className = "badge bg-secondary";
    } else {
        logDiv.innerHTML += `\n‚ùå ${result.message}\n`;
    }
    logDiv.scrollTop = logDiv.scrollHeight;
};

document.getElementById('clear').onclick = () => {
    logDiv.innerHTML = '';
};
</script>
</body>
</html>
